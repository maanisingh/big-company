# Escrow System Flow Diagram

## ğŸ”„ Complete Transaction Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ESCROW SYSTEM FLOW                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RETAILER â”‚          â”‚ COMPANY  â”‚          â”‚WHOLESALERâ”‚          â”‚   BLNK    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: ORDER CREATION & ESCROW HOLD                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  1. Order from      â”‚                     â”‚                     â”‚
     â”‚  Wholesaler         â”‚                     â”‚                     â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                     â”‚
     â”‚  (2M RWF)           â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ 2. Create Escrow    â”‚                     â”‚
     â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚ (Move 2M to escrow) â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â”‚ Transaction ID      â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ 3. Save to DB       â”‚                     â”‚
     â”‚                     â”‚ (status: held)      â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  4. Order Confirmed â”‚                     â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                     â”‚
     â”‚  (Escrow ID)        â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  Now Awaits         â”‚                     â”‚ 5. Ship Order       â”‚
     â”‚  Delivery           â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: DELIVERY CONFIRMATION & ESCROW RELEASE (Option A: Manual)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  6. Delivery        â”‚                     â”‚                     â”‚
     â”‚  Received âœ…         â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ 7. Confirm Delivery â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ 8. Release Escrow   â”‚                     â”‚
     â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚ (2M to wholesaler)  â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â”‚ Success             â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ 9. Update DB        â”‚                     â”‚
     â”‚                     â”‚ (status: released)  â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ 10. Notify          â”‚                     â”‚
     â”‚                     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  Payment Received   â”‚
     â”‚                     â”‚                     â”‚  âœ… (2M RWF)         â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2 ALT: AUTO-RELEASE (Option B: Timeout after 7 days)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  [7 days pass]      â”‚                     â”‚                     â”‚
     â”‚  [No dispute]       â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Cron Job Runs       â”‚                     â”‚
     â”‚                     â”‚ (processAutoReleases)                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Auto-Release â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Update DB           â”‚                     â”‚
     â”‚                     â”‚ (status: expired)   â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Notify â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚  Payment Received   â”‚
     â”‚                     â”‚                     â”‚  âœ… (Auto-released)  â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 3: REPAYMENT (Retailer owes Company 2M RWF)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ Option A: Auto-Deduct (Daily Job)        â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚  Daily Sales: 1M    â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Cron Job Runs       â”‚                     â”‚
     â”‚                     â”‚ (processAutoDeductions)                   â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Calculate 30% of 1M â”‚                     â”‚
     â”‚                     â”‚ = 300K RWF          â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Deduct from Wallet â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                     â”‚ (if balance >= 10K) â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                     â”‚ Success             â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Record Repayment    â”‚                     â”‚
     â”‚                     â”‚ (method: auto_deduct)                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ Notification:       â”‚                     â”‚                     â”‚
     â”‚ 300K deducted       â”‚                     â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                     â”‚
     â”‚ Outstanding: 1.7M   â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ [Repeat daily until fully repaid]         â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ Option B: Manual Repayment                â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ Manual Payment      â”‚                     â”‚                     â”‚
     â”‚ (Mobile Money/Bank) â”‚                     â”‚                     â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚                     â”‚
     â”‚ (500K RWF)          â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Record Repayment    â”‚                     â”‚
     â”‚                     â”‚ (method: mobile_money)                    â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ Receipt âœ…           â”‚                     â”‚                     â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚                     â”‚
     â”‚ Outstanding: 1.5M   â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DISPUTE SCENARIO (Alternative Flow)                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ Issue with Order    â”‚                     â”‚                     â”‚
     â”‚ (Wrong items/       â”‚                     â”‚                     â”‚
     â”‚  damaged goods)     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚ Raise Dispute â”€â”€â”€â”€â”€>â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Update DB           â”‚                     â”‚
     â”‚                     â”‚ (status: disputed)  â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Notify Admin        â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ Alert â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ [Manual Resolution] â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚ â†’ Refund Retailer   â”‚                     â”‚
     â”‚                     â”‚ â†’ Release to Wholesaler                   â”‚
     â”‚                     â”‚ â†’ Partial refund    â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
     â”‚                     â”‚                     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 DATABASE SCHEMA RELATIONSHIPS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     escrow_transactions              â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ â€¢ id (PK)                            â”‚
â”‚ â€¢ order_id (UNIQUE)                  â”‚
â”‚ â€¢ retailer_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â€¢ wholesaler_id           â”‚          â”‚
â”‚ â€¢ order_amount            â”‚          â”‚
â”‚ â€¢ escrow_amount           â”‚          â”‚
â”‚ â€¢ status (held/released)  â”‚          â”‚
â”‚ â€¢ auto_release_at         â”‚          â”‚
â”‚ â€¢ blnk_transaction_ref    â”‚          â”‚
â”‚ â€¢ created_at              â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
            â”‚                          â”‚
            â”‚ 1:N                      â”‚
            â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     escrow_repayments                                    â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id (PK)                                                â”‚
â”‚ â€¢ escrow_transaction_id (FK) â”€â”˜                         â”‚
â”‚ â€¢ retailer_id                                            â”‚
â”‚ â€¢ repayment_amount                                       â”‚
â”‚ â€¢ repayment_method (auto_deduct/mobile_money/etc)       â”‚
â”‚ â€¢ status                                                 â”‚
â”‚ â€¢ created_at                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  escrow_auto_deductions              â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ retailer_id (PK)                   â”‚
â”‚ â€¢ enabled (default: true)            â”‚
â”‚ â€¢ deduction_percentage (30%)         â”‚
â”‚ â€¢ minimum_balance_rwf (10K)          â”‚
â”‚ â€¢ max_daily_deduction_rwf            â”‚
â”‚ â€¢ max_total_outstanding_rwf (5M)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  escrow_settings (global)            â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ setting_key (PK)                   â”‚
â”‚ â€¢ setting_value                      â”‚
â”‚ â€¢ description                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 STATUS TRANSITIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  HELD   â”‚ â—„â”€â”€ Initial state when escrow is created
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€â”€â”€â”€â”€â–º [Wholesaler confirms] â”€â”€â”€â”€â–º RELEASED
        â”‚
        â”œâ”€â”€â”€â”€â”€â–º [7 days timeout] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º EXPIRED (auto-released)
        â”‚
        â”œâ”€â”€â”€â”€â”€â–º [Retailer disputes] â”€â”€â”€â”€â”€â”€â”€â–º DISPUTED
        â”‚
        â””â”€â”€â”€â”€â”€â–º [Order cancelled] â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º REFUNDED

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 API ENDPOINT SUMMARY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

RETAILER APIs:
   GET    /retailer/escrow/summary
   GET    /retailer/escrow/transactions
   GET    /retailer/escrow/transactions/:id
   POST   /retailer/escrow/repayment
   GET    /retailer/escrow/auto-deduct-settings
   PATCH  /retailer/escrow/auto-deduct-settings
   POST   /retailer/escrow/dispute/:id

WHOLESALER APIs:
   GET    /wholesaler/escrow/pending-confirmations
   POST   /wholesaler/escrow/confirm-delivery/:id
   GET    /wholesaler/escrow/summary
   GET    /wholesaler/escrow/transactions

CRON JOBS (To be implemented):
   â° Daily 2 AM:  processAutoReleases()
   â° Daily 11 PM: processAutoDeductions()

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
